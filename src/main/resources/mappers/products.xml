<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chunjae.project5.persis.ProductsMapper">
    <resultMap id="ProductsVO" type="com.chunjae.project5.entity.ProductsVO">
        <result property="productNo" column="product_no" />
        <result property="userId" column="user_id" />
        <result property="photoFile" column="photo_file"/>
        <result property="productId" column="product_id" />
    </resultMap>
    <select id="getList">
        SELECT  a.product_no ,a.title , a.price, c.user_id, a.active, a.condition2, a.regdate, a.addr1,a.addr2,a.postcode, b.category, d.photo_file
        FROM products a JOIN category b ON (a.category=b.category) JOIN user c ON (a.user_id= c.user_id) JOIN photos d ON (a.product_no=d.product_no)
    <where>
        <if test="type != null">
            <trim prefixOverrides="OR">
                <choose>
                    <when test="type == 'T'.toString()">
                        a.title  LIKE concat('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'C'.toString()">
                        a.location LIKE concat('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'W'.toString()">
                        c.user_id LIKE concat('%', #{keyword}, '%')
                    </when>
                </choose>
            </trim>
        </if>
        <if test="category != null">
            AND b.category = #{category}
        </if>
    </where>
    order by a.regdate limit #{postStart}, #{postCount}
    </select>

    <select id="getCount" resultType="integer">
        select COUNT(*) from products
    </select>

    <resultMap id="Category" type="com.chunjae.project5.entity.Category">
        <result property="category" column="category" />
        <result property="categoryName" column="category_name"/>
    </resultMap>
    <select id="categories" parameterType="map">
        select * from category
    </select>

    <insert id="productsInsert">
        insert into products (category, title, price, description, addr1, addr2, postcode, condition2, user_id, active) values (#{category}, #{title}, #{price}, #{description}, #{addr1},  #{addr2},  #{postcode},#{condition2}, 2, '0')
        <selectKey resultType="int" keyProperty="prodcuct_no" order="AFTER">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>


</mapper>